<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REDERAR - Simulador Solar</title>
    <link rel="icon" type="image/jpeg" href="https://i.postimg.cc/Pv5PgCWs/LOGO-2024.jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #002244;
        }
        .rederar-yellow {
            color: #FFC107;
        }
        .rederar-blue {
            color: #0056B3;
        }
        .bg-rederar-blue {
            background-color: #0056B3;
        }
        .bg-rederar-light-blue {
            background-color: #007bff;
        }
        .disabled-button {
            opacity: 0.6;
            cursor: not-allowed;
        }
        /* New styles for the unified layout */
        .grid-container {
            display: grid;
            gap: 2rem;
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
        @media (min-width: 768px) {
            .grid-container {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden p-6 sm:p-10">
        <div class="flex flex-col items-center mb-8">
            <img src="https://i.postimg.cc/Pv5PgCWs/LOGO-2024.jpg" alt="Logo de REDERAR" class="mb-4 h-24 object-contain rounded-full">
            <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-2">
                DIMENSIONAMIENTO INICIAL SISTEMA SOLAR
            </h1>
            <p class="text-center text-gray-600">Dimensiona tu sistema On-Grid o Off-Grid y solicita una cotización.</p>
        </div>

        <div class="bg-rederar-blue p-6 rounded-xl shadow-lg mb-10 border border-blue-600">
            <div class="flex items-center mb-4 text-white">
                <div class="bg-white p-3 rounded-full text-rederar-blue mr-4 shadow-md">
                    <i class="fas fa-user"></i>
                </div>
                <h2 class="text-2xl font-bold">Datos del Cliente</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label for="clientName" class="block text-sm font-medium text-white">Nombre Completo</label>
                    <input type="text" id="clientName" class="client-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rederar-blue focus:ring-rederar-blue p-2 border" placeholder="Juan Pérez">
                </div>
                <div>
                    <label for="clientPhone" class="block text-sm font-medium text-white">Teléfono</label>
                    <input type="tel" id="clientPhone" class="client-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rederar-blue focus:ring-rederar-blue p-2 border" placeholder="+5493434802264">
                </div>
                <div>
                    <label for="clientAddress" class="block text-sm font-medium text-white">Dirección</label>
                    <input type="text" id="clientAddress" class="client-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rederar-blue focus:ring-rederar-blue p-2 border" placeholder="Av. Siempre Viva 742, Paraná">
                </div>
            </div>
        </div>

        <div class="grid-container">
            <div>
                <div class="bg-gray-100 p-6 rounded-xl shadow-lg border border-gray-200 mb-8">
                    <div class="flex items-center mb-4">
                        <div class="bg-rederar-blue p-3 rounded-full text-white mr-4 shadow-md">
                            <i class="fas fa-plug"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-rederar-blue">Sistema On-Grid</h2>
                    </div>
                    <p class="text-gray-600 mb-6">Calcula el tamaño del sistema solar conectado a la red. Ingresa tu consumo anual y la provincia.</p>
                    
                    <div class="space-y-4 mb-6">
                        <div>
                            <label for="annualConsumption" class="block text-sm font-medium text-gray-700">Consumo Anual de Energía (kWh)</label>
                            <input type="number" id="annualConsumption" class="pv-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="e.g., 3500" min="0">
                        </div>
                        <div>
                            <label for="provinceOnGrid" class="block text-sm font-medium text-gray-700">Provincia</label>
                            <select id="provinceOnGrid" class="pv-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="">Selecciona una provincia</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="onGridResults" class="hidden mt-6 transition-all duration-300">
                        <div id="onGridErrorMessage" class="text-red-600 text-sm font-semibold mb-2"></div>
                        <div id="onGridSuccessContent" class="space-y-3 p-4 bg-blue-50 rounded-lg border border-blue-300">
                            </div>
                    </div>

                    <div class="mt-6 flex flex-col gap-2">
                        <button id="calculateOnGridBtn" onclick="calculateOnGridSystem()" disabled class="w-full bg-rederar-blue hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 disabled-button">
                            Calcular Sistema On-Grid
                        </button>
                        <p class="text-sm text-gray-500 text-center">Para calcular el sistema debe tener cargado datos del cliente.</p>
                    </div>
                    <button onclick="sendOnGridQuoteRequest()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 mt-4">
                        <i class="fab fa-whatsapp mr-2"></i> Solicitar Cotización On-Grid
                    </button>
                </div>
                
                <div class="bg-gray-100 p-6 rounded-xl shadow-lg border border-gray-200">
                    <div class="flex items-center mb-4">
                        <div class="bg-rederar-blue p-3 rounded-full text-white mr-4 shadow-md">
                            <i class="fas fa-solar-panel"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-rederar-blue">Sistema Off-Grid</h2>
                    </div>
                    <p class="text-gray-600 mb-6">Calcula los componentes para un sistema aislado. Agrega tus artefactos y selecciona la provincia.</p>
                    
                    <div class="space-y-4 mb-6">
                        <div>
                            <label for="artefactList" class="block text-sm font-medium text-gray-700">Consumo Diario (W)</label>
                            <div id="artefactContainer" class="space-y-2">
                                <div class="flex gap-2">
                                    <input type="text" placeholder="Artefacto (ej. Heladera)" class="artefact-name w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                    <input type="number" placeholder="Potencia (W)" class="artefact-watts w-full rounded-md border-gray-300 shadow-sm p-2 border" min="1">
                                    <input type="number" placeholder="Horas/día" class="artefact-hours w-full rounded-md border-gray-300 shadow-sm p-2 border" min="1">
                                    <button onclick="removeArtefact(this)" class="bg-red-500 hover:bg-red-600 text-white p-2 rounded-full h-10 w-10 flex items-center justify-center">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <button onclick="addArtefactInput()" class="w-full bg-rederar-light-blue hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow-lg transition duration-300 mt-2">
                                <i class="fas fa-plus mr-2"></i>Añadir Artefacto
                            </button>
                        </div>
                        <div>
                            <label for="provinceOffGrid" class="block text-sm font-medium text-gray-700">Provincia</label>
                            <select id="provinceOffGrid" class="pv-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="">Selecciona una provincia</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="offGridResults" class="hidden mt-6 transition-all duration-300">
                        <div id="offGridErrorMessage" class="text-red-600 text-sm font-semibold mb-2"></div>
                        <div id="offGridSuccessContent" class="space-y-3 p-4 bg-blue-50 rounded-lg border border-blue-300">
                            </div>
                    </div>
                    
                    <div class="mt-6 flex flex-col gap-2">
                        <button id="calculateOffGridBtn" onclick="calculateOffGridSystem()" disabled class="w-full bg-rederar-blue hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 disabled-button">
                            Calcular Sistema Off-Grid
                        </button>
                        <p class="text-sm text-gray-500 text-center">Para calcular el sistema debe tener cargado datos del cliente.</p>
                    </div>
                    <button onclick="sendOffGridQuoteRequest()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 mt-4">
                        <i class="fab fa-whatsapp mr-2"></i> Solicitar Cotización Off-Grid
                    </button>
                </div>
            </div>

            <div>
                <div class="bg-gray-100 p-6 rounded-xl shadow-lg border border-gray-200">
                    <div class="flex items-center mb-4">
                        <div class="bg-rederar-blue p-3 rounded-full text-white mr-4 shadow-md">
                            <i class="fas fa-water"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-rederar-blue">Dimensionamiento de Termotanque Solar</h2>
                    </div>
                    <p class="text-gray-600 mb-6">Calcula la capacidad ideal del termotanque solar y el número de tubos para tu hogar.</p>

                    <div class="space-y-4 mb-6">
                        <div>
                            <label for="numPeople" class="block text-sm font-medium text-gray-700">Número de personas en el hogar</label>
                            <input type="number" id="numPeople" class="thermal-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="e.g., 4" min="1">
                        </div>
                        <div>
                            <label for="provinceThermal" class="block text-sm font-medium text-gray-700">Provincia</label>
                            <select id="provinceThermal" class="thermal-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="">Selecciona una provincia</option>
                            </select>
                        </div>
                    </div>

                    <div id="thermalResults" class="hidden mt-6 transition-all duration-300">
                        <div id="thermalErrorMessage" class="text-red-600 text-sm font-semibold mb-2"></div>
                        <div id="thermalSuccessContent" class="space-y-3 p-4 bg-blue-50 rounded-lg border border-blue-300">
                            </div>
                    </div>
                    
                    <div class="mt-6 flex flex-col gap-2">
                        <button id="calculateThermalBtn" onclick="calculateThermalSystem()" disabled class="w-full bg-rederar-blue hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 disabled-button">
                            Calcular Termotanque Solar
                        </button>
                        <p class="text-sm text-gray-500 text-center">Para calcular el sistema debe tener cargado datos del cliente.</p>
                    </div>
                    <button onclick="sendThermalQuoteRequest()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 mt-4">
                        <i class="fab fa-whatsapp mr-2"></i> Solicitar Cotización Termotanque
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-10 py-6 text-center text-white bg-rederar-blue rounded-xl max-w-7xl mx-auto shadow-inner border border-blue-600">
        <div class="flex justify-center items-center mb-2">
            <img src="https://i.postimg.cc/Pv5PgCWs/LOGO-2024.jpg" alt="Logo de REDERAR" class="h-16 object-contain rounded-full">
        </div>
        <p class="text-sm text-gray-300">&copy; 2024 REDERAR. Todos los derechos reservados.</p>
    </footer>

    <div id="custom-alert-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Aviso</h3>
            <p id="custom-alert-message" class="text-gray-700 mb-6"></p>
            <button onclick="closeAlert()" class="w-full bg-rederar-blue hover:bg-blue-700 text-white font-bold py-2 rounded-full transition duration-300">
                Aceptar
            </button>
        </div>
    </div>

    <script>
        // --- PWA SETUP ---
        const manifestData = { "name": "REDERAR - Simulador Solar", "short_name": "REDERAR Solar", "description": "Herramienta para dimensionar sistemas de Termotanques Solares.", "start_url": "./index.html", "display": "standalone", "background_color": "#002244", "theme_color": "#0056B3", "icons": [ { "src": "https://i.postimg.cc/Pv5PgCWs/LOGO-2024.jpg", "sizes": "192x192", "type": "image/jpeg" }, { "src": "https://i.postimg.cc/Pv5PgCWs/LOGO-2024.jpg", "sizes": "512x512", "type": "image/jpeg" } ] };
        const serviceWorkerCode = `const CACHE_NAME = 'rederar-solar-cache-v1'; const urlsToCache = [ '/', '/index.html', 'https://cdn.tailwindcss.com', 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css', 'https://i.postimg.cc/Pv5PgCWs/LOGO-2024.jpg' ]; self.addEventListener('install', event => { event.waitUntil( caches.open(CACHE_NAME).then(cache => { console.log('Cache opened'); return cache.addAll(urlsToCache); }) ); }); self.addEventListener('fetch', event => { event.respondWith( caches.match(event.request).then(response => { if (response) { return response; } return fetch(event.request); }) ); });`;
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const manifestBlob = new Blob([JSON.stringify(manifestData)], { type: 'application/json' });
                const manifestUrl = URL.createObjectURL(manifestBlob);
                const manifestLink = document.createElement('link');
                manifestLink.rel = 'manifest';
                manifestLink.href = manifestUrl;
                document.head.appendChild(manifestLink);
                const workerBlob = new Blob([serviceWorkerCode], { type: 'application/javascript' });
                const workerUrl = URL.createObjectURL(workerBlob);
                navigator.serviceWorker.register(workerUrl).then(registration => { console.log('Service Worker registrado con éxito:', registration.scope); }).catch(error => { console.log('Fallo el registro de Service Worker:', error); });
            });
        }
        // --- END PWA SETUP ---

        // Data for provinces
        const provinceData = {
            'buenos-aires': { name: 'Buenos Aires', solarRadiation: 3.9, consumptionFactor: 40 },
            'cordoba': { name: 'Córdoba', solarRadiation: 4.8, consumptionFactor: 38 },
            'santa-fe': { name: 'Santa Fe', solarRadiation: 4.5, consumptionFactor: 39 },
            'mendoza': { name: 'Mendoza', solarRadiation: 5.5, consumptionFactor: 35 },
            'tucuman': { name: 'Tucumán', solarRadiation: 4.2, consumptionFactor: 37 },
            'entre-rios': { name: 'Entre Ríos', solarRadiation: 4.2, consumptionFactor: 40 },
            'salta': { name: 'Salta', solarRadiation: 5.8, consumptionFactor: 36 },
            'corrientes': { name: 'Corrientes', solarRadiation: 4.0, consumptionFactor: 41 },
            'misiones': { name: 'Misiones', solarRadiation: 3.8, consumptionFactor: 42 },
            'chaco': { name: 'Chaco', solarRadiation: 4.4, consumptionFactor: 39 },
            'santiago-del-estero': { name: 'Santiago del Estero', solarRadiation: 5.0, consumptionFactor: 36 },
            'san-juan': { name: 'San Juan', solarRadiation: 6.0, consumptionFactor: 34 },
            'san-luis': { name: 'San Luis', solarRadiation: 5.2, consumptionFactor: 38 },
            'catamarca': { name: 'Catamarca', solarRadiation: 5.6, consumptionFactor: 35 },
            'la-rioja': { name: 'La Rioja', solarRadiation: 5.9, consumptionFactor: 34 },
            'jujuy': { name: 'Jujuy', solarRadiation: 5.1, consumptionFactor: 36 },
            'la-pampa': { name: 'La Pampa', solarRadiation: 4.8, consumptionFactor: 37 },
            'neuquen': { name: 'Neuquén', solarRadiation: 4.5, consumptionFactor: 45 },
            'rio-negro': { name: 'Río Negro', solarRadiation: 4.6, consumptionFactor: 44 },
            'chubut': { name: 'Chubut', solarRadiation: 4.0, consumptionFactor: 43 },
            'santa-cruz': { name: 'Santa Cruz', solarRadiation: 3.5, consumptionFactor: 48 },
            'tierra-del-fuego': { name: 'Tierra del Fuego', solarRadiation: 2.5, consumptionFactor: 50 },
            'formosa': { name: 'Formosa', solarRadiation: 4.1, consumptionFactor: 40 }
        };

        // Component Constants
        const PANEL_WATT = 550; // Wattage of a standard panel
        const PANEL_AREA = 2.4; // Area in square meters
        const INVERTER_MODELS = [3000, 5000, 8000, 10000]; // Common inverter capacities in W
        const BATTERY_AH = 200; // Ah of a standard battery
        const BATTERY_VOLTAGE = 12; // V
        const SYSTEM_VOLTAGE = 24; // V for off-grid system

        // Thermal Constants
        const TUBE_LITERS = 7.5;
        const TUBE_PER_MODEL = [10, 15, 20, 25, 30];
        const THERMAL_CAPACITY_LITERS = [100, 150, 200, 250, 300];
        const dailyWaterConsumptionPerPerson = 40;

        // Custom alert modal functions
        function showAlert(message) {
            document.getElementById('custom-alert-message').innerText = message;
            document.getElementById('custom-alert-modal').classList.remove('hidden');
        }
        function closeAlert() {
            document.getElementById('custom-alert-modal').classList.add('hidden');
        }

        document.addEventListener('DOMContentLoaded', () => {
            populateProvinces('provinceOnGrid');
            populateProvinces('provinceOffGrid');
            populateProvinces('provinceThermal');

            const clientInputs = document.querySelectorAll('.client-input');
            const pvInputs = document.querySelectorAll('.pv-input');
            const thermalInputs = document.querySelectorAll('.thermal-input');
            const artefactContainer = document.getElementById('artefactContainer');

            clientInputs.forEach(input => input.addEventListener('input', checkAllInputs));
            pvInputs.forEach(input => input.addEventListener('input', checkAllInputs));
            thermalInputs.forEach(input => input.addEventListener('input', checkAllInputs));
            artefactContainer.addEventListener('input', checkAllInputs);

            checkAllInputs();
        });

        function populateProvinces(selectId) {
            const provinceSelect = document.getElementById(selectId);
            if (!provinceSelect) return;
            provinceSelect.innerHTML = '<option value="">Selecciona una provincia</option>';
            for (const key in provinceData) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = provinceData[key].name;
                provinceSelect.appendChild(option);
            }
        }

        function checkAllInputs() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientPhone = document.getElementById('clientPhone').value.trim();
            const clientAddress = document.getElementById('clientAddress').value.trim();
            const isClientDataComplete = clientName !== '' && clientPhone !== '' && clientAddress !== '';

            // Check On-Grid
            const annualConsumption = document.getElementById('annualConsumption').value.trim();
            const provinceOnGrid = document.getElementById('provinceOnGrid').value;
            const isOnGridDataComplete = annualConsumption !== '' && parseInt(annualConsumption) > 0 && provinceOnGrid !== '';
            const calculateOnGridBtn = document.getElementById('calculateOnGridBtn');
            calculateOnGridBtn.disabled = !(isClientDataComplete && isOnGridDataComplete);
            calculateOnGridBtn.classList.toggle('disabled-button', !(isClientDataComplete && isOnGridDataComplete));

            // Check Off-Grid
            const artefactWatts = Array.from(document.querySelectorAll('.artefact-watts')).map(input => input.value.trim());
            const artefactHours = Array.from(document.querySelectorAll('.artefact-hours')).map(input => input.value.trim());
            const provinceOffGrid = document.getElementById('provinceOffGrid').value;
            const isOffGridDataComplete = artefactWatts.every(val => val !== '' && parseInt(val) > 0) && artefactHours.every(val => val !== '' && parseInt(val) > 0) && provinceOffGrid !== '';
            const calculateOffGridBtn = document.getElementById('calculateOffGridBtn');
            calculateOffGridBtn.disabled = !(isClientDataComplete && isOffGridDataComplete);
            calculateOffGridBtn.classList.toggle('disabled-button', !(isClientDataComplete && isOffGridDataComplete));

            // Check Thermal
            const numPeople = document.getElementById('numPeople').value.trim();
            const provinceThermal = document.getElementById('provinceThermal').value;
            const isThermalDataComplete = numPeople !== '' && parseInt(numPeople) > 0 && provinceThermal !== '';
            const calculateThermalBtn = document.getElementById('calculateThermalBtn');
            calculateThermalBtn.disabled = !(isClientDataComplete && isThermalDataComplete);
            calculateThermalBtn.classList.toggle('disabled-button', !(isClientDataComplete && isThermalDataComplete));
        }
        
        // --- ON-GRID FUNCTIONS ---
        function calculateOnGridSystem() {
            const annualConsumption = parseFloat(document.getElementById('annualConsumption').value);
            const provinceKey = document.getElementById('provinceOnGrid').value;
            const solarRadiation = provinceData[provinceKey].solarRadiation;

            const resultsDiv = document.getElementById('onGridResults');
            const errorMessage = document.getElementById('onGridErrorMessage');
            const successContent = document.getElementById('onGridSuccessContent');
            
            if (isNaN(annualConsumption) || annualConsumption <= 0 || !provinceKey) {
                resultsDiv.classList.remove('hidden');
                errorMessage.innerText = 'Por favor, ingresa un consumo anual válido y selecciona una provincia.';
                successContent.classList.add('hidden');
                return false;
            }

            errorMessage.innerText = '';
            successContent.classList.remove('hidden');
            resultsDiv.classList.remove('hidden');

            const dailyConsumption = annualConsumption / 365;
            const dailyEnergyRequired = dailyConsumption * 1.25;
            const pvArrayPower = (dailyEnergyRequired / solarRadiation);
            const numPanels = Math.ceil(pvArrayPower * 1000 / PANEL_WATT);
            const totalPanelArea = numPanels * PANEL_AREA;
            
            let inverterPower = pvArrayPower * 1000 * 1.2;
            let inverterModel = INVERTER_MODELS.find(model => model >= inverterPower);
            if (!inverterModel) {
                inverterModel = Math.max(...INVERTER_MODELS);
            }

            successContent.innerHTML = `
                <p id="onGridPanelResult" class="text-rederar-blue font-semibold">Cantidad de Paneles Solares: ${numPanels} unidades de ${PANEL_WATT}Wp</p>
                <p id="onGridInverterResult" class="text-rederar-blue font-semibold">Potencia del Inversor: ${inverterModel}W</p>
                <p class="text-gray-600 italic mt-4">**Importante:** Esta es una estimación inicial. Se recomienda una evaluación en sitio para un diseño final. El inversor debe ser compatible con la red local y con el modelo de paneles.</p>
            `;
            return true;
        }

        function sendOnGridQuoteRequest() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientPhone = document.getElementById('clientPhone').value.trim();
            const clientAddress = document.getElementById('clientAddress').value.trim();
            if (!clientName || !clientPhone || !clientAddress) {
                showAlert('Por favor, completa los datos del cliente antes de solicitar una cotización.');
                return;
            }
            if (!calculateOnGridSystem()) return;

            const annualConsumption = document.getElementById('annualConsumption').value;
            const selectedProvinceName = document.getElementById('provinceOnGrid').options[document.getElementById('provinceOnGrid').selectedIndex].text;
            const panelResult = document.getElementById('onGridPanelResult').innerText;
            const inverterResult = document.getElementById('onGridInverterResult').innerText;

            const message = `*SOLICITUD DE COTIZACIÓN ON-GRID*\n\n` +
                            `*Datos del Cliente:*\n` +
                            `Nombre: ${clientName}\n` +
                            `Teléfono: ${clientPhone}\n` +
                            `Dirección: ${clientAddress}\n` +
                            `Provincia: ${selectedProvinceName}\n\n` +
                            `*Dimensionamiento Inicial:*\n` +
                            `Consumo Anual: ${annualConsumption} kWh\n` +
                            `${panelResult}\n` +
                            `${inverterResult}\n`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://api.whatsapp.com/send?phone=+543434802264&text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // --- OFF-GRID FUNCTIONS ---
        function addArtefactInput() {
            const container = document.getElementById('artefactContainer');
            const newArtefactHtml = `
                <div class="flex gap-2">
                    <input type="text" placeholder="Artefacto (ej. Heladera)" class="artefact-name w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    <input type="number" placeholder="Potencia (W)" class="artefact-watts w-full rounded-md border-gray-300 shadow-sm p-2 border" min="1">
                    <input type="number" placeholder="Horas/día" class="artefact-hours w-full rounded-md border-gray-300 shadow-sm p-2 border" min="1">
                    <button onclick="removeArtefact(this)" class="bg-red-500 hover:bg-red-600 text-white p-2 rounded-full h-10 w-10 flex items-center justify-center">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newArtefactHtml);
            checkAllInputs();
        }

        function removeArtefact(button) {
            button.closest('.flex').remove();
            checkAllInputs();
        }

        function calculateOffGridSystem() {
            const artefactWatts = Array.from(document.querySelectorAll('.artefact-watts'));
            const artefactHours = Array.from(document.querySelectorAll('.artefact-hours'));
            const provinceKey = document.getElementById('provinceOffGrid').value;

            const resultsDiv = document.getElementById('offGridResults');
            const errorMessage = document.getElementById('offGridErrorMessage');
            const successContent = document.getElementById('offGridSuccessContent');

            let totalDailyWh = 0;
            let totalWatts = 0;
            let isValid = true;

            for (let i = 0; i < artefactWatts.length; i++) {
                const watts = parseFloat(artefactWatts[i].value);
                const hours = parseFloat(artefactHours[i].value);
                if (isNaN(watts) || isNaN(hours) || watts <= 0 || hours <= 0) {
                    isValid = false;
                    break;
                }
                totalDailyWh += watts * hours;
                totalWatts += watts;
            }
            if (!isValid || !provinceKey) {
                resultsDiv.classList.remove('hidden');
                errorMessage.innerText = 'Por favor, ingresa artefactos válidos (Potencia y Horas) y selecciona una provincia.';
                successContent.classList.add('hidden');
                return false;
            }

            errorMessage.innerText = '';
            successContent.classList.remove('hidden');
            resultsDiv.classList.remove('hidden');

            const solarRadiation = provinceData[provinceKey].solarRadiation;
            const requiredKwh = totalDailyWh / 1000 * 1.2;
            const pvArrayPowerKw = requiredKwh / solarRadiation;
            const numPanels = Math.ceil(pvArrayPowerKw * 1000 / PANEL_WATT);
            const inverterModel = INVERTER_MODELS.find(model => model >= totalWatts);
            
            const batteryCapacityWh = totalDailyWh * 1.5 * 2; // 1.5 autonomy days, x2 for 50% DOD
            const batteryAhTotal = batteryCapacityWh / SYSTEM_VOLTAGE;
            const numBatteries = Math.ceil(batteryAhTotal / BATTERY_AH);

            successContent.innerHTML = `
                <p id="offGridPanelResult" class="text-rederar-blue font-semibold">Cantidad de Paneles Solares: ${numPanels} unidades de ${PANEL_WATT}Wp</p>
                <p id="offGridInverterResult" class="text-rederar-blue font-semibold">Potencia del Inversor: ${inverterModel ? inverterModel + 'W' : 'A definir'}</p>
                <p id="offGridBatteryResult" class="text-rederar-blue font-semibold">Cantidad de Baterías: ${numBatteries} unidades de ${BATTERY_AH}Ah</p>
                <p class="text-gray-600 italic mt-4">**Importante:** Esta es una estimación inicial. Se requiere una evaluación detallada para el diseño final. Los valores de potencia y baterías son aproximados.</p>
            `;
            return true;
        }

        function sendOffGridQuoteRequest() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientPhone = document.getElementById('clientPhone').value.trim();
            const clientAddress = document.getElementById('clientAddress').value.trim();
            if (!clientName || !clientPhone || !clientAddress) {
                showAlert('Por favor, completa los datos del cliente antes de solicitar una cotización.');
                return;
            }
            if (!calculateOffGridSystem()) return;

            const artefactList = Array.from(document.querySelectorAll('#artefactContainer .flex')).map(div => {
                const name = div.querySelector('.artefact-name').value;
                const watts = div.querySelector('.artefact-watts').value;
                const hours = div.querySelector('.artefact-hours').value;
                return `- ${name} (${watts}W x ${hours}h)`;
            }).join('\n');
            const selectedProvinceName = document.getElementById('provinceOffGrid').options[document.getElementById('provinceOffGrid').selectedIndex].text;
            const panelResult = document.getElementById('offGridPanelResult').innerText;
            const inverterResult = document.getElementById('offGridInverterResult').innerText;
            const batteryResult = document.getElementById('offGridBatteryResult').innerText;

            const message = `*SOLICITUD DE COTIZACIÓN OFF-GRID*\n\n` +
                            `*Datos del Cliente:*\n` +
                            `Nombre: ${clientName}\n` +
                            `Teléfono: ${clientPhone}\n` +
                            `Dirección: ${clientAddress}\n` +
                            `Provincia: ${selectedProvinceName}\n\n` +
                            `*Artefactos y Consumo:*\n` +
                            `${artefactList}\n\n` +
                            `*Dimensionamiento Inicial:*\n` +
                            `${panelResult}\n` +
                            `${inverterResult}\n` +
                            `${batteryResult}\n`;

            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://api.whatsapp.com/send?phone=+543434802264&text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // --- THERMAL FUNCTIONS ---
        function calculateThermalSystem() {
            const numPeople = parseInt(document.getElementById('numPeople').value);
            const selectedProvinceKey = document.getElementById('provinceThermal').value;
            
            const resultsDiv = document.getElementById('thermalResults');
            const errorMessage = document.getElementById('thermalErrorMessage');
            const successContent = document.getElementById('thermalSuccessContent');

            if (isNaN(numPeople) || numPeople <= 0 || !selectedProvinceKey) {
                resultsDiv.classList.remove('hidden');
                errorMessage.innerText = 'Por favor, ingresa un número de personas válido y selecciona una provincia.';
                successContent.classList.add('hidden');
                return false;
            }

            errorMessage.innerText = '';
            successContent.classList.remove('hidden');
            resultsDiv.classList.remove('hidden');
            
            const requiredLiters = numPeople * dailyWaterConsumptionPerPerson;
            let tankCapacity = THERMAL_CAPACITY_LITERS.find(capacity => capacity >= requiredLiters);
            if (!tankCapacity) {
                tankCapacity = Math.max(...THERMAL_CAPACITY_LITERS);
            }

            let numTubes = Math.ceil(tankCapacity / TUBE_LITERS);
            let commercialTubes = TUBE_PER_MODEL.find(tubes => tubes >= numTubes);
            if (!commercialTubes) {
                commercialTubes = Math.max(...TUBE_PER_MODEL);
            }

            successContent.innerHTML = `
                <p id="thermalCapacityResult" class="text-rederar-blue font-semibold">Capacidad del termotanque solar: ${tankCapacity} litros</p>
                <p id="thermalTubesResult" class="text-rederar-blue font-semibold">Cantidad de tubos evacuados: ${commercialTubes} tubos</p>
                <p class="text-gray-600 italic mt-4">**Importante:** Esta es una estimación inicial. Los valores pueden variar según las condiciones reales y el diseño final del sistema.</p>
            `;
            return true;
        }
        
        function sendThermalQuoteRequest() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientPhone = document.getElementById('clientPhone').value.trim();
            const clientAddress = document.getElementById('clientAddress').value.trim();

            if (!clientName || !clientPhone || !clientAddress) {
                showAlert('Por favor, completa los datos del cliente antes de solicitar una cotización.');
                return;
            }
            if (!calculateThermalSystem()) return;

            const numPeople = document.getElementById('numPeople').value;
            const selectedProvinceName = document.getElementById('provinceThermal').options[document.getElementById('provinceThermal').selectedIndex].text;
            const capacityResult = document.getElementById('thermalCapacityResult').innerText;
            const tubesResult = document.getElementById('thermalTubesResult').innerText;

            const message = `*SOLICITUD DE COTIZACIÓN TERMOTANQUE SOLAR*\n\n` +
                            `*Datos del Cliente:*\n` +
                            `Nombre: ${clientName}\n` +
                            `Teléfono: ${clientPhone}\n` +
                            `Dirección: ${clientAddress}\n` +
                            `Provincia: ${selectedProvinceName}\n\n` +
                            `*Dimensionamiento Inicial:*\n` +
                            `Cantidad de personas: ${numPeople}\n` +
                            `${capacityResult}\n` +
                            `${tubesResult}\n`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://api.whatsapp.com/send?phone=+543434802264&text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }
    </script>
</body>
</html>
